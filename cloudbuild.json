{
  "steps": [
    {
      "name": "gcr.io/cloud-builders/docker",
      "id": "php_main",
      "args": [
        "build",
        "--build-arg",
        "WORKFOLDER=${_APP_FOLDER_}",
        "-t",
        "gcr.io/$PROJECT_ID/marketreminder_php",
        "--target",
        "${_ENV_PRODUCTION_STAGE_}",
        "--cache-from",
        "gcr.io/$PROJECT_ID/marketreminder_php",
        "."
      ]
    },
    {
      "name": "gcr.io/cloud-builders/docker",
      "id": "nginx_main",
      "args": [
        "build",
        "--build-arg",
        "WORKFOLDER=${_APP_FOLDER_}",
        "--target",
        "${_ENV_PRODUCTION_STAGE_}",
        "-t",
        "gcr.io/$PROJECT_ID/marketreminder_nginx",
        "./docker/nginx"
      ],
      "waitFor": "php_main",
      "timeout": "10s"
    }
  ],
  "images": ["gcr.io/$PROJECT_ID/marketreminder_php", "gcr.io/$PROJECT_ID/marketreminder_nginx"],
  "substitutions": {
    "_APP_FOLDER_": "/var/www/marketReminder",
    "_ENV_PRODUCTION_STAGE_": "production"
  }
}
