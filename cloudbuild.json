{
  "steps": [
    {
      "name": "gcr.io/cloud-builders/yarn",
      "id": "main_front_assets_install",
      "args": ["install"],
      "timeout": "80s"
    },
    {
      "name": "gcr.io/cloud-builders/yarn",
      "id": "main_front_assets_build",
      "args": ["build"],
      "waitFor": ["main_front_assets_install"],
      "timeout": "45s"
    },
    {
      "name": "gcr.io/cloud-builders/docker",
      "id": "php_main",
      "args": [
        "build",
        "--build-arg",
        "WORKFOLDER=${_APP_FOLDER_}",
        "--target",
        "${_PHP_BUILD_TARGET_}",
        "-t",
        "gcr.io/$PROJECT_ID/marketreminder",
        "--cache-from",
        "gcr.io/$PROJECT_ID/marketreminder",
        "."
      ],
      "waitFor": ["main_front_assets_build"]
    },
    {
      "name": "gcr.io/cloud-builders/docker",
      "id": "nginx_main",
      "args": [
        "build",
        "--build-arg",
        "WORKFOLDER=${_APP_FOLDER_}",
        "-t",
        "gcr.io/$PROJECT_ID/marketreminder_nginx",
        "./docker/nginx"
      ],
      "timeout": "10s"
    }
  ],
  "images": ["gcr.io/$PROJECT_ID/marketreminder", "gcr.io/$PROJECT_ID/marketreminder_nginx"],
  "substitutions": {
    "_APP_FOLDER_": "/var/www/marketReminder",
    "_PHP_BUILD_TARGET_": "base"
  }
}
